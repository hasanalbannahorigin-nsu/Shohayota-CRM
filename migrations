4a) 20251204_ai_usage_logs.sql
CREATE TABLE IF NOT EXISTS ai_usage_logs (
  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
  tenant_id uuid NOT NULL,
  user_id uuid,
  prompt text,
  result jsonb,
  created_at timestamptz DEFAULT now()
);

4b) 20251204_add_tenant_id_columns.sql
-- Add tenant_id columns if missing
ALTER TABLE IF EXISTS users ADD COLUMN IF NOT EXISTS tenant_id uuid;
ALTER TABLE IF EXISTS customers ADD COLUMN IF NOT EXISTS tenant_id uuid;
ALTER TABLE IF EXISTS tickets ADD COLUMN IF NOT EXISTS tenant_id uuid;
ALTER TABLE IF EXISTS messages ADD COLUMN IF NOT EXISTS tenant_id uuid;
ALTER TABLE IF EXISTS bug_reports ADD COLUMN IF NOT EXISTS tenant_id uuid;
ALTER TABLE IF EXISTS feature_requests ADD COLUMN IF NOT EXISTS tenant_id uuid;

4c) 20251204_enable_rls.sql
-- Enable row-level security & create tenant policy for core tables
ALTER TABLE IF EXISTS customers ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS customers_tenant_policy ON customers
  USING (tenant_id::text = current_setting('app.current_tenant', true)::text);

ALTER TABLE IF EXISTS tickets ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS tickets_tenant_policy ON tickets
  USING (tenant_id::text = current_setting('app.current_tenant', true)::text);

ALTER TABLE IF EXISTS messages ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS messages_tenant_policy ON messages
  USING (tenant_id::text = current_setting('app.current_tenant', true)::text);

ALTER TABLE IF EXISTS bug_reports ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS bug_reports_tenant_policy ON bug_reports
  USING (tenant_id::text = current_setting('app.current_tenant', true)::text);

ALTER TABLE IF EXISTS feature_requests ENABLE ROW LEVEL SECURITY;
CREATE POLICY IF NOT EXISTS feature_requests_tenant_policy ON feature_requests
  USING (tenant_id::text = current_setting('app.current_tenant', true)::text);